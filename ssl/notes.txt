# Generate root directory for all certs
$ mkdir ssl
$ cd ssl


### Root CA
$ mkdir root_ca
$ vim root_ca/root_ca.cnf


# Create key for root CA
# Can be generated with the root CA cert - I think I'd rather do this?
$ openssl genrsa \
    -aes256 \
    -out root_ca/ca.key.pem \
    4096
password

# Create cert for root CA
# Prints to stdout by default, so specify -out
# -x509 generates a self-signed cert instead of a certificate signing request (-in is used to sign a csr)
# -new generates a new request
# -batch for non-interactive
# Input key and output cert can not be specified in the config file?
$ openssl req \
    -new \
    -x509 \
    -config root_ca/root_ca.cnf \
    -key root_ca/ca.key.pem \
    -out root_ca/ca.cert.pem


### Intermediate CA
$ mkdir intermediate_ca

# Generate key for intermediate CA
$ openssl genrsa \
    -aes256 \
    -out intermediate_ca/intermediate.key.pem \
    4096
password

$ touch intermediate_ca/index.txt
$ echo '00' > intermediate_ca/serial.txt
$ vim intermediate_ca/intermediate_ca.cnf

# Generate certificate signing request (CSR) for intermediate CA
$ openssl req \
    -new \
    -config intermediate_ca/intermediate_ca.cnf \
      -key intermediate_ca/intermediate.key.pem \
      -out intermediate_ca/intermediate.csr.pem
