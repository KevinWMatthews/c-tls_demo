# OpenSSL configuration file for intermediate CA.

# Configuration for `openssl req`
# See `man req` or https://www.openssl.org/docs/manmaster/man5/x509v3_config.html
[ req ]
dir                 = intermediate_ca
default_keyfile     = $dir/ca.key.pem           # Name of generated private key. Overridden by -keyout
default_bits        = 4096                      # If used with -new, specify number of bits in key. Override with -newkey
distinguished_name  = req_distinguished_name    # Specify config file section for Distinguished Name.
string_mask         = utf8only                  # Permit only these characters
default_md          = sha256                    # Override with -[digest]

prompt = no                                     # Read config file for Distinguished Name. Do not prompt user.
# req_extensions = req_ext                        # Config file section that extends the certificate request. Override with -reqexts
x509_extensions     = v3_ca                     # Extensions for when -x509 is used. Overriden by -extensions

[ req_distinguished_name ]
# If prompt = no, specify values for Distinguished Name
countryName             = "US"                                  # C
stateOrProvinceName     = "California"                          # ST
localityName            = "Monterey"                            # L
organizationName        = "CyberData Corporation"               # O
organizationalUnitName  = "CyberData Certificate Authority"     # ON
commonName              = "CyberData Intermediate CA"           # CN
# emailAddress =
# name
# surname
# givenName
# initials ?
# dnQualifier

# If prompt = yes, you may override the prompts for Distinguished Name
# countryName             = "Enter a two-letter Country Name"
# countryName_min         = 2
# # countryName_max is always 2
# stateOrProvinceName     = "Enter a full US State name"
# stateOrProvinceName_min = 2                         # Weird, you can still leave it blank
# localityName            = "Enter a city name"
# organizationName        = "Enter your company name (min 1, max 42)"
# organizationName_min    = 1
# organizationName_max    = 42

# Extensions for a typical CA
# See `man x509v3_config` or https://www.openssl.org/docs/manmaster/man5/x509v3_config.html
[ v3_ca ]
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid:always,issuer
# Specify is this is a CA and optionally how many CA's can be below this cert in the chain.
basicConstraints        = critical, CA:true
# Specify allowed operations for the private key
keyUsage                = critical, digitalSignature, keyCertSign
# Specify allowed operations for the certificate public key
# extendedKeyUsage        =

# Configuration for `openssl ca`, which is used sign Certificate Signing Requests, which generates a certificate
# Not needed to self-sign its own certificate but is needed to sign the CSR of an intermediate CA.
# See `man ca`
[ ca ]
default_ca = CA_default

[ CA_default ]
dir                 = ./root_ca             # Convenience variable
# certs               = certs                 # Not sure if/what this does
new_certs_dir       = $(dir)/new_certs             # Directory for new certificates. Overridden by -outdir. Mandatory.
database            = $(dir)/index.txt
serial              = $(dir)/serial.txt
private_key         = $(dir)/ca.key.pem    # Private key of signing CA. Overridden by -keyfile. Mandatory.
certificate         = $(dir)/ca.cert.pem   # Certificate of signing CA. Overridden by -cert. Mandatory.
default_md          = sha256
name_opt            = ca_default            # Recommended
cert_opt            = ca_default
default_days        = 1000
preserve            = no
policy              = policy_strict

[ policy_loose ]
# Allow the intermediate CA to sign a more diverse range of certificates.
# See the POLICY FORMAT section of the `ca` man page.
countryName             = optional
stateOrProvinceName     = optional
localityName            = optional
organizationName        = optional
organizationalUnitName  = optional
commonName              = supplied
emailAddress            = optional

### x509 extensions
# For `openssl ca` or `openssl req`, select using -extensions option or config file section x509_extensions

# Default x509 extensions for `openssl ca`
[ x509_extensions ]

# Extensions for client certificates (`man x509v3_config`).
[ client_cert ]
basicConstraints        = CA:FALSE
nsCertType              = client, email
nsComment               = "OpenSSL Generated Client Certificate"
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid,issuer
keyUsage                = critical, nonRepudiation, digitalSignature, keyEncipherment
extendedKeyUsage        = clientAuth, emailProtection

# Extensions for server certificates (`man x509v3_config`).
[ server_cert ]
basicConstraints        = CA:FALSE
nsCertType              = server
nsComment               = "OpenSSL Generated Server Certificate"
subjectKeyIdentifier    = hash
authorityKeyIdentifier  = keyid,issuer:always
keyUsage                = critical, digitalSignature, keyEncipherment
extendedKeyUsage        = serverAuth
